<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Our Memories ‚Äî For You ‚ù§Ô∏è</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- =========================
       GLOBAL STYLES
  ========================== -->
  <style>
    :root{
      --card-w: 260px;
      --card-h: 360px;
      --ring-depth: 480px;
      --shadow: 0 18px 40px rgba(0,0,0,.28);
      --accent: #ff6fa6;
      --accent2: #8a7dff;
      --glass: rgba(255,255,255,.22);
      --ink: #ffffff;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color: var(--ink);
      background: linear-gradient(135deg, #f9c5d1, #9795ef);
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      cursor: none; /* we use a custom cursor */
    }

    /* Top UI bar */
    .topbar{
      position: fixed; inset: 0 0 auto 0; height: 72px; display: grid; grid-template-columns: 1fr auto auto auto; gap: 12px; align-items: center;
      padding: 12px 18px; z-index: 6;
      background: linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,0));
      pointer-events: none;
    }
    .topbar > * { pointer-events: auto; }
    .title{
      font-weight: 700; letter-spacing:.5px; text-shadow: 0 6px 22px rgba(0,0,0,.35); font-size: clamp(18px,3.4vw,28px);
      display:flex; align-items:center; gap:10px;
    }
    .title .tiny{font-weight:500; opacity:.9; font-size: .9rem}
    .pill{
      display:inline-flex; align-items:center; gap:8px; border-radius:999px; padding:10px 14px; background: var(--glass); backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,.25); box-shadow: 0 6px 20px rgba(0,0,0,.15);
      user-select:none;
    }
    .btn{
      border:none; border-radius:999px; padding:10px 14px; font-weight:600; color:#fff; background: linear-gradient(90deg, var(--accent), var(--accent2));
      box-shadow: 0 10px 26px rgba(0,0,0,.25); cursor:pointer; transition: transform .2s ease, box-shadow .2s ease; white-space:nowrap;
    }
    .btn:hover{ transform: translateY(-2px); box-shadow:0 16px 34px rgba(0,0,0,.32);}
    .btn:active{ transform: translateY(0); }

    /* Countdown */
    .countdown{
      display:flex; align-items:center; gap:10px; font-weight:600; font-variant-numeric: tabular-nums; background: var(--glass);
      border: 1px solid rgba(255,255,255,.25); padding:10px 14px; border-radius:14px; backdrop-filter: blur(10px);
    }
    .countdown .num{min-width: 2ch; text-align:right;}

    /* Music control */
    .music{
      width:48px; height:48px; border-radius:50%; display:grid; place-items:center; background:var(--glass);
      border:1px solid rgba(255,255,255,.25); box-shadow: 0 10px 26px rgba(0,0,0,.25); cursor:pointer;
    }
    .music svg{width:24px; height:24px; fill:#fff}

    /* Theme switcher */
    .switcher{ display:flex; align-items:center; gap:10px; background: var(--glass); border:1px solid rgba(255,255,255,.25); border-radius:999px; padding:6px; }
    .swatch{
      width:28px; height:28px; border-radius:50%; border:2px solid #ffffffaa; box-shadow: 0 6px 16px rgba(0,0,0,.18); cursor:pointer;
    }

    /* 3D Carousel region */
    .stage{
      position:absolute; left:50%; top:54%; transform: translate(-50%, -50%);
      width: min(92vw, 980px); height: min(70vh, 640px);
      display:grid; place-items:center; perspective: 2200px;
    }

    .carousel{
      width: 420px; height: 320px; position: relative;
      transform-style: preserve-3d; transition: transform .9s cubic-bezier(.22,.9,.2,1);
    }

    .card{
      position:absolute; top:50%; left:50%;
      width: var(--card-w); height: var(--card-h);
      transform: translate(-50%,-50%); border-radius: 22px; overflow: hidden; background:#fff;
      box-shadow: var(--shadow);
      display:flex; flex-direction:column; justify-content:flex-end; align-items:stretch;
      transition: transform .45s ease, box-shadow .45s ease, filter .45s ease;
      will-change: transform, filter;
    }
    .card img{
      position:absolute; inset:0; width:100%; height:100%; object-fit: cover;
      transform: scale(1.02); transition: transform .45s ease;
    }
    .card:hover{ transform: translate(-50%,-50%) scale(1.04); box-shadow: 0 28px 60px rgba(0,0,0,.42); }
    .card:hover img{ transform: scale(1.08); }

    .caption{
      position:relative; z-index:1; background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.55));
      color:#fff; padding:16px 16px 14px; font-weight:600; letter-spacing:.2px; text-shadow:0 6px 18px rgba(0,0,0,.45);
    }

    /* Hidden love letter */
    .love-wrap{
      position: fixed; left: 50%; bottom: 22px; transform: translateX(-50%); z-index: 6;
      display:flex; gap:12px; align-items:center;
    }
    .love-letter{
      max-width: min(92vw, 720px); background: var(--glass); backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,.3); padding: 14px 18px; border-radius: 16px;
      box-shadow: 0 16px 40px rgba(0,0,0,.25); display:none;
    }
    .love-letter.show{ display:block; animation: pop .45s cubic-bezier(.2,1,.2,1); }
    @keyframes pop{ from{ transform: translateY(12px); opacity:.0; } to{ transform: translateY(0); opacity:1; } }

    /* Floating hearts background layer */
    .hearts{
      position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden;
    }
    .heart{
      position:absolute; bottom:-40px; color: rgba(255, 75, 130, .85);
      font-size: 20px; animation: floatUp 7s linear infinite;
      text-shadow: 0 8px 18px rgba(0,0,0,.3);
    }
    @keyframes floatUp{
      0%{ transform: translateY(0) scale(1); opacity:.95; }
      100%{ transform: translateY(-110vh) scale(1.3); opacity:0; }
    }

    /* Fireworks canvas overlay */
    canvas#fx{
      position: fixed; inset: 0; pointer-events: none; z-index: 5;
    }

    /* Custom heart cursor */
    .cursor{
      position: fixed; left:0; top:0; width:22px; height:22px; pointer-events:none; z-index: 7;
      transform: translate(-50%, -50%);
      filter: drop-shadow(0 4px 10px rgba(0,0,0,.35));
    }
    .cursor svg{ width:22px; height:22px; display:block; }

    /* ===== NEW: Floating button to special.html ===== */
    .goto-special{
      position: fixed; right: 22px; bottom: 22px; z-index: 7;
      display:inline-flex; align-items:center; gap:8px;
      padding: 12px 16px; border-radius: 999px; font-weight: 700;
      text-decoration: none; color:#fff;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      border: 1px solid rgba(255,255,255,.25);
      box-shadow: 0 12px 28px rgba(0,0,0,.28);
      backdrop-filter: blur(8px);
      transition: transform .2s ease, box-shadow .2s ease;
    }
    .goto-special:hover{
      transform: translateY(-2px);
      box-shadow: 0 18px 38px rgba(0,0,0,.34);
    }

    /* Accessibility / small screens */
    @media (max-width: 720px){
      :root{ --card-w: 220px; --card-h: 300px; --ring-depth: 420px; }
      .carousel{ width: 360px; height: 280px; }
      .love-wrap{ bottom: 16px; }
      .title{ font-size: 18px; }
      .pill{ padding: 8px 12px; }
      .music{ width:44px; height:44px; }
    }
  </style>
</head>

<body>
  <!-- =========================
       CUSTOM HEART CURSOR
  ========================== -->
  <div class="cursor" id="cursor">
    <svg viewBox="0 0 24 24" fill="#ff6fa6" aria-hidden="true">
      <path d="M12 21s-6.716-4.374-9.5-7.158C.716 12.058.5 9.25 2.318 7.432a4.5 4.5 0 0 1 6.364 0L12 10.75l3.318-3.318a4.5 4.5 0 0 1 6.364 6.364C18.716 16.626 12 21 12 21z"/>
    </svg>
  </div>

  <!-- =========================
       TOP BAR (title ‚Ä¢ countdown ‚Ä¢ theme ‚Ä¢ music)
  ========================== -->
  <div class="topbar">
    <div class="title">
      <span>üíñ Our Beautiful Memories</span>
      <span class="tiny">‚Äî made only for you</span>
    </div>

    <div class="countdown" id="countdown" aria-live="polite">
      <span>Since us:</span>
      <span class="num" id="d">00</span>d
      <span class="num" id="h">00</span>h
      <span class="num" id="m">00</span>m
      <span class="num" id="s">00</span>s
    </div>

    <div class="switcher" id="switcher" title="Switch background theme">
      <button class="swatch" style="background: conic-gradient(from 0deg, #f9c5d1, #9795ef);" data-theme="0" aria-label="Theme 1"></button>
      <button class="swatch" style="background: conic-gradient(from 0deg, #ffecd2, #fcb69f);" data-theme="1" aria-label="Theme 2"></button>
      <button class="swatch" style="background: conic-gradient(from 0deg, #a18cd1, #fbc2eb);" data-theme="2" aria-label="Theme 3"></button>
      <button class="swatch" style="background: conic-gradient(from 0deg, #0f2027, #203a43, #2c5364);" data-theme="3" aria-label="Theme 4 (night)"></button>
    </div>

    <button class="music" id="music" aria-label="Toggle music">
      <!-- play/pause icon will toggle via JS -->
      <svg id="icon-play" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
      <svg id="icon-pause" viewBox="0 0 24 24" style="display:none;"><path d="M6 5h4v14H6zm8 0h4v14h-4z"/></svg>
    </button>
  </div>

  <!-- =========================
       FIREWORKS CANVAS
  ========================== -->
  <canvas id="fx" aria-hidden="true"></canvas>

  <!-- =========================
       3D CAROUSEL
  ========================== -->
  <section class="stage" aria-label="Memory carousel">
    <div class="carousel" id="carousel">
      <!-- Each card = one memory (KEEP your paths) -->
      <figure class="card"><img src="images/photo1.jpg" alt="Memory 1"><figcaption class="caption">Our first date ‚Äî I still get butterflies.</figcaption></figure>
      <figure class="card"><img src="images/photo2.jpg" alt="Memory 2"><figcaption class="caption">That smile that melts my whole world.</figcaption></figure>
      <figure class="card"><img src="images/photo3.jpg" alt="Memory 3"><figcaption class="caption">A walk where time slowed down for us.</figcaption></figure>
      <figure class="card"><img src="images/photo4.jpg" alt="Memory 4"><figcaption class="caption">Our little adventure ‚Äî just you & me.</figcaption></figure>
      <figure class="card"><img src="images/photo5.jpg" alt="Memory 5"><figcaption class="caption">The moment I knew: it‚Äôs always you.</figcaption></figure>
      <!-- Add more by copying a figure -->
    </div>
  </section>

  <!-- =========================
       HIDDEN LOVE MESSAGE + BUTTON
  ========================== -->
  <div class="love-wrap">
    <button class="btn" id="reveal">üíå Open a little note</button>
    <div class="love-letter" id="letter">
      My love, thank you for every laugh, every soft moment, every brave day we‚Äôve shared.
      I choose you today, tomorrow, and in all my tiny forever‚Äôs. ‚Äî Yours, always. üíó
    </div>
  </div>

  <!-- =========================
       FLOATING HEARTS BACKDROP
  ========================== -->
  <div class="hearts" id="hearts"></div>

  <!-- =========================
       BACKGROUND MUSIC
  ========================== -->
  <audio id="bgm" loop>
    <source src="music/can-i-call-you-tonight.mp3" type="audio/mpeg">
  </audio>

  <!-- ===== NEW: Floating link to special.html (bottom-right) ===== -->
  <a class="goto-special" href="final.html" aria-label="Go to the special page">‚ú® Next ‡¶è ‡¶Ø‡¶æ‡¶®</a>

  <!-- =========================
       SCRIPTS
  ========================== -->
  <script>
    /* -------------------------------------------
       Custom Cursor (heart follows the pointer)
    -------------------------------------------- */
    (function(){
      const cur = document.getElementById('cursor');
      let x=window.innerWidth/2, y=window.innerHeight/2, tx=x, ty=y;
      window.addEventListener('mousemove', (e)=>{ tx=e.clientX; ty=e.clientY; });
      function tick(){
        x += (tx - x) * 0.18;
        y += (ty - y) * 0.18;
        cur.style.transform = `translate(${x}px, ${y}px)`;
        requestAnimationFrame(tick);
      }
      tick();
    })();

    /* -------------------------------------------
       Themes (background gradients)
    -------------------------------------------- */
    (function(){
      const themes = [
        'linear-gradient(135deg, #f9c5d1, #9795ef)',
        'linear-gradient(135deg, #ffecd2, #fcb69f)',
        'linear-gradient(135deg, #a18cd1, #fbc2eb)',
        'radial-gradient(1000px 600px at 50% 0%, #ffffff22, transparent), linear-gradient(180deg, #0f2027, #203a43 55%, #2c5364)'
      ];
      const switcher = document.getElementById('switcher');
      switcher.addEventListener('click', (e)=>{
        const btn = e.target.closest('.swatch');
        if(!btn) return;
        const idx = +btn.dataset.theme || 0;
        document.body.style.background = themes[idx];
      });
    })();

    /* -------------------------------------------
       Countdown (set your start date!)
    -------------------------------------------- */
    (function(){
      // CHANGE THIS to the date your relationship started (YYYY-MM-DDTHH:MM:SS)
      const startDate = new Date('2022-01-21T00:00:00');
      const d = document.getElementById('d'),
            h = document.getElementById('h'),
            m = document.getElementById('m'),
            s = document.getElementById('s');
      function pad(n){ return String(n).padStart(2,'0'); }
      function tick(){
        const now = new Date();
        let diff = Math.max(0, now - startDate);
        const days = Math.floor(diff / (1000*60*60*24)); diff -= days*(1000*60*60*24);
        const hrs  = Math.floor(diff / (1000*60*60));     diff -= hrs *(1000*60*60);
        const mins = Math.floor(diff / (1000*60));        diff -= mins*(1000*60);
        const secs = Math.floor(diff / 1000);
        d.textContent = days;
        h.textContent = pad(hrs);
        m.textContent = pad(mins);
        s.textContent = pad(secs);
      }
      tick();
      setInterval(tick, 1000);
    })();

    /* -------------------------------------------
       Music control
    -------------------------------------------- */
    (function(){
      const audio = document.getElementById('bgm');
      const btn = document.getElementById('music');
      const playI = document.getElementById('icon-play');
      const pauseI = document.getElementById('icon-pause');

      // Try to autoplay softly (some browsers block until user gesture)
      audio.volume = 0.35;
      audio.play().catch(()=>{ /* wait for user */ });

      btn.addEventListener('click', ()=>{
        if(audio.paused){ audio.play(); playI.style.display='none'; pauseI.style.display='block'; }
        else { audio.pause(); playI.style.display='block'; pauseI.style.display='none'; }
      });

      // reflect initial state
      audio.addEventListener('play', ()=>{ playI.style.display='none'; pauseI.style.display='block'; });
      audio.addEventListener('pause',()=>{ playI.style.display='block'; pauseI.style.display='none'; });
    })();

    /* -------------------------------------------
       Hidden love letter reveal
    -------------------------------------------- */
    (function(){
      const btn = document.getElementById('reveal');
      const letter = document.getElementById('letter');
      let shown = false;
      btn.addEventListener('click', ()=>{
        shown = !shown;
        letter.classList.toggle('show', shown);
      });
    })();

    /* -------------------------------------------
       Floating hearts backdrop
    -------------------------------------------- */
    (function(){
      const wrap = document.getElementById('hearts');
      function createHeart(){
        const el = document.createElement('div');
        el.className = 'heart';
        el.textContent = '‚ù§';
        el.style.left = Math.random()*100 + 'vw';
        el.style.fontSize = (16 + Math.random()*22) + 'px';
        el.style.animationDuration = (5 + Math.random()*5) + 's';
        wrap.appendChild(el);
        setTimeout(()=> el.remove(), 11000);
      }
      setInterval(createHeart, 700);
    })();

    /* -------------------------------------------
       Fireworks on click (canvas particles)
    -------------------------------------------- */
    (function(){
      const c = document.getElementById('fx');
      const ctx = c.getContext('2d');
      let W, H, DPR = Math.min(2, window.devicePixelRatio || 1);
      const parts = [];
      function size(){
        W = c.width  = innerWidth * DPR;
        H = c.height = innerHeight * DPR;
        c.style.width = innerWidth + 'px';
        c.style.height= innerHeight + 'px';
      }
      size(); addEventListener('resize', size);

      function burst(x, y){
        const n = 120, base = Math.random()*Math.PI*2;
        for(let i=0;i<n;i++){
          const a = base + i/n * Math.PI*2;
          const sp = (2 + Math.random()*4) * DPR;
          parts.push({
            x:x*DPR, y:y*DPR, vx: Math.cos(a)*sp, vy: Math.sin(a)*sp,
            life: 60 + Math.random()*40,
            color: `hsl(${Math.floor(Math.random()*360)}, 85%, 65%)`,
            r: 1 + Math.random()*2
          });
        }
      }
      addEventListener('click', (e)=> burst(e.clientX, e.clientY));

      function tick(){
        ctx.clearRect(0,0,W,H);
        for(let i=parts.length-1;i>=0;i--){
          const p = parts[i];
          p.x += p.vx; p.y += p.vy; p.vy += 0.12*DPR; p.life--;
          ctx.globalCompositeOperation = 'lighter';
          ctx.fillStyle = p.color;
          ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
          if(p.life<=0 || p.y>H+30*DPR) parts.splice(i,1);
        }
        requestAnimationFrame(tick);
      }
      tick();
    })();

    /* -------------------------------------------
       3D Carousel (drag, wheel, autoplay)
    -------------------------------------------- */
    (function(){
      const container = document.getElementById('carousel');
      const cards = Array.from(container.querySelectorAll('.card'));
      const total = cards.length;
      const step = 360 / total;
      let rotation = 0;

      // Position cards on the ring
      function layout(){
        cards.forEach((card, i)=>{
          const ang = i * step;
          card.style.transform = `translate(-50%,-50%) rotateY(${ang}deg) translateZ(var(--ring-depth))`;
          // depth shading (optional subtle blur for far cards)
          const diff = Math.abs((((ang - rotation) % 360) + 540) % 360 - 180) / 180; // 0 front .. 1 back
          card.style.filter = `saturate(${1 - diff*0.25}) brightness(${1 - diff*0.12})`;
        });
        container.style.transform = `rotateY(${rotation}deg)`;
      }
      layout();

      // Wheel rotate (snap by one card)
      addEventListener('wheel', (e)=>{
        e.preventDefault();
        rotation += (e.deltaY > 0 ? -step : step);
        layout();
      }, {passive:false});

      // Drag rotate
      let dragging = false, startX = 0, lastX = 0, vel = 0, raf;
      const onMove = (x)=>{
        const dx = x - lastX;
        rotation += dx * 0.25;
        vel = dx;
        layout();
        lastX = x;
      };
      addEventListener('mousedown', (e)=>{ dragging=true; startX=lastX=e.clientX; cancelAnimationFrame(raf); });
      addEventListener('mousemove', (e)=>{ if(dragging) onMove(e.clientX); });
      addEventListener('mouseup',   ()=>{ if(!dragging) return; dragging=false; inertia(); });

      // Touch
      addEventListener('touchstart', (e)=>{ dragging=true; startX=lastX=e.touches[0].clientX; cancelAnimationFrame(raf); }, {passive:true});
      addEventListener('touchmove',  (e)=>{ if(dragging) onMove(e.touches[0].clientX); }, {passive:true});
      addEventListener('touchend',   ()=>{ if(!dragging) return; dragging=false; inertia(); }, {passive:true});

      // Inertia after drag
      function inertia(){
        function stepInertia(){
          rotation += vel * 0.9;
          vel *= 0.9;
          layout();
          if(Math.abs(vel) > 0.25) raf = requestAnimationFrame(stepInertia);
        }
        stepInertia();
      }

      // Autoplay (slow rotate) ‚Äî pauses while dragging
      let autoplay = true;
      setInterval(()=>{
        if(autoplay && !dragging){
          rotation += -step; // rotate to next card
          layout();
        }
      }, 4500);

      // Pause autoplay while pointer is over stage
      const stage = document.querySelector('.stage');
      stage.addEventListener('mouseenter', ()=> autoplay=false);
      stage.addEventListener('mouseleave', ()=> autoplay=true);
    })();
  </script>
</body>
</html>